import { useContext, useState } from "react";
import { AppContext } from "../components/Store";
import Head from "next/head";
import Image from "next/image";
import Nav from "./Nav";
import Footer from "./Footer";
import Chat from "./Chat";

function Layout({children, title}) {
  const {dispatch, state} = useContext(AppContext);
  const {chatVisible, chatSign} = state;

  const HandleNavOff = () => {
    dispatch({ type: "MENUOFF" });
  };

  const HandleCallSign = () => {
    let signMessage = "START A LIVE CHAT";
    dispatch({type: "ADDCHATSIGN", payload: signMessage})
  }

  const ResetCallSign =() => {
    dispatch({type: "REMOVECHATSIGN"})
  }

  const HandleShowChat = () => {
    dispatch({type: "CHATVISIBILITY"})
  }



  return (
    <div>
      <Head>
        <title>{title}</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <header>
        <nav
          className="sticky top-0 bg-white flex justify-between items-center p-5"
          onMouseOver={HandleNavOff}
        >
          <Image src="/logo.svg" alt="logo" width={200} height={120} />
          <div className="flex items-center w-2/6 justify-evenly">
            <span>
              <button className="hidden md:block bg-blue-700 font-bold text-xl text-white rounded-full p-3 px-8">
                OPEN ACCOUNT
              </button>
            </span>
            <span>
              <button className="hidden md:block bg-slate-200 font-bold text-xl text-blue-700 rounded-full p-3 px-10">
                LOG IN
              </button>
            </span>
            <span>
              <Image
                className="rounded cursor-pointer"
                src="/flag.svg"
                width={30}
                height={10}
                alt="flag"
              />
            </span>
          </div>
        </nav>
        <hr />
        <Nav handleNavOff={HandleNavOff} />
      </header>
      <main onMouseOver={HandleNavOff}>{children}</main>
      <hr className="hidden md:block" />
      <footer className="md:px-16 p-6">
        <Footer />
      </footer>
      {!chatVisible ? (
        <div
          className="hidden md:flex justify-evenly items-center fixed bottom-0 right-0 bg-blue-700 w-20 p-5 m-5 rounded-full cursor-pointer hover:w-72 hover:h-20 duration-200"
          onMouseEnter={HandleCallSign}
          onMouseLeave={ResetCallSign}
          onClick={HandleShowChat}
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="40"
            height="40"
            fill="currentColor"
            className="bi bi-headset text-white"
            viewBox="0 0 16 16"
          >
            <path d="M8 1a5 5 0 0 0-5 5v1h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V6a6 6 0 1 1 12 0v6a2.5 2.5 0 0 1-2.5 2.5H9.366a1 1 0 0 1-.866.5h-1a1 1 0 1 1 0-2h1a1 1 0 0 1 .866.5H11.5A1.5 1.5 0 0 0 13 12h-1a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h1V6a5 5 0 0 0-5-5z" />
          </svg>
          <p className="text-white font-bold">{chatSign}</p>
        </div>
      ) : (
        <Chat />
      )}
    </div>
  );
}

export default Layout
